\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{myref}[2011/04/29]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Declare package options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language options
\newif\if@myenglish \@myenglishfalse
\DeclareOption{myenglish}{\@myenglishtrue}
\newif\if@myfrancais \@myfrancaisfalse
\DeclareOption{myfrancais}{\@myfrancaistrue}
% To have smart reference with 'varioref' package
\newif\if@smartref \@smartreffalse
\DeclareOption{smartref}{\@smartreftrue}
% In case of unknown options
\DeclareOption*{%
	\PackageWarning{myref}{Unknown option `\CurrentOption'}%
}

\ProcessOptions

%% Options to pass to packages
\if@smartref
	\if@myenglish
		\PassOptionsToPackage{english}{varioref}
	\fi
	\if@myfrancais
		\PassOptionsToPackage{french}{varioref}
	\fi
\fi

%% Packages to call
\RequirePackage{xifthen}
\RequirePackage{xkeyval}
% The 'suffix' package offers the '\WithSuffix' command to define starred commands
\RequirePackage{suffix}
\if@smartref
	% The 'varioref' produces smart reference with page precision if needed
	\RequirePackage{varioref}
\fi

%%%%%%%%%%%%%%%%%%%%%%%
%% New configuration %%
%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%
%% New commands %%
%%%%%%%%%%%%%%%%%%
\newcommand{\myref@lang@figuretitle}{\figurename}
\newcommand{\myref@lang@tabletitle}{\tablename}
% Define some language commands
\if@myenglish
	\newcommand{\myref@lang@see}{see}
	\newcommand{\myref@lang@sectiontitle}{Section}
	\newcommand{\myref@lang@subsectiontitle}{Sub-section}
	\newcommand{\myref@lang@subsubsectiontitle}{Sub-Sub-section}
\fi
\if@myfrancais
	\newcommand{\myref@lang@see}{voir}
	\newcommand{\myref@lang@sectiontitle}{Section}
	\newcommand{\myref@lang@subsectiontitle}{Sous-section}
	\newcommand{\myref@lang@subsubsectiontitle}{Sous-Sous-section}
\fi
%% To define the reference name
% The word(s) to put before the number of the reference (like 'section' or 'figure' for example).
\define@key[my]{ref}{refname}[none]{\def\myref@name{#1}}
\setkeys[my]{ref}{refname={}}
% Boolean value to make a reference on the form '(see Chapter 1)' instead of 'Chapter 1'.
\define@boolkey[my]{ref}{refsee}[false]{}
\setkeys[my]{ref}{refsee={false}}
% Define the 'see'-word for see-reference (see 'refsee') -> difficult to understand ugh ?
% For example, if 'refseename' is 'foo', a see-reference will produce '(foo Chapter 1)' instead of '(see Chapter 1)'.
\define@key[my]{ref}{refseename}[\myref@lang@see]{\def\myref@seename{#1}}
\setkeys[my]{ref}{refseename=\myref@lang@see}
% Use '\setkeys[my]{ref}{refdefaultfont={<whatever>}}' to change the default font for reference.
\define@key[my]{ref}{refdefaultfont}[]{\def\myref@default@font{#1}}
\setkeys[my]{ref}{refdefaultfont={}}
% Define the font for the 'refname' word(s).
% 'refdefaultfont' MUST be initialized before.
\define@key[my]{ref}{reffont}[\myref@default@font]{\def\myref@font{#1}}
\setkeys[my]{ref}{reffont={\myref@default@font}}
%% Define the standard reference
\newcommand{\myref}[2][]{%
	\setkeys[my]{ref}{#1}%
	\ifmy@ref@refsee%
		\if@smartref%
			(\myref@seename\ {\myref@font\myref@name}~\vref{#2})%
		\else%
			(\myref@seename\ {\myref@font\myref@name}~\ref{#2})%
		\fi%
	\else%
		\if@smartref%
			{\myref@font\myref@name}~\vref{#2}%
		\else%
			{\myref@font\myref@name}~\ref{#2}%
		\fi%
	\fi%
	% Reinitialized all key values
	\setkeys[my]{ref}{refname={},refsee={false},refseename=\myref@lang@see,reffont={\myref@default@font}}%
	}
% The starred version of '\myref' activate the 'refsee'.
\WithSuffix\newcommand\myref*[2][]{\myref[#1]{#2}}
% Intermediate command to test the presence of optional arguments
\newcommand{\mycustomsref}[3]{%
	\ifx#1\@empty%
		\myref[refname=#2]{#3}%
	\else%
		\myref[refname=#2,#1]{#3}%
	\fi%
}
% The starred version of '\mycustomsref' to activate the 'refsee' flag.
\WithSuffix\newcommand\mycustomsref*[3]{\mycustomsref{refsee=true,#1}{#2}{#3}}
%% About specialized command for references.
%% The starred versions are activating the 'refsee' flag.
% For reference on part.
\newcommand\mypartref[2][]{\mycustomsref{#1}{\partname}{#2}}
\WithSuffix\newcommand\mypartref*[2][]{\mycustomsref*{#1}{\partname}{#2}}
% For reference on chapter.
\newcommand\mychapterref[2][]{\mycustomsref{#1}{\chaptername}{#2}}
\WithSuffix\newcommand\mychapterref*[2][]{\mycustomsref*{#1}{\chaptername}{#2}}
% For reference on section.
\newcommand\mysectionref[2][]{\mycustomsref{#1}{\myref@lang@sectiontitle}{#2}}
\WithSuffix\newcommand\mysectionref*[2][]{\mycustomsref*{#1}{\myref@lang@sectiontitle}{#2}}
% For reference on subsection.
\newcommand\mysubsectionref[2][]{\mycustomsref{#1}{\myref@lang@subsectiontitle}{#2}}
\WithSuffix\newcommand\mysubsectionref*[2][]{\mycustomsref*{#1}{\myref@lang@subsectiontitle}{#2}}
% For reference on subsubsection.
\newcommand\mysubsubsectionref[2][]{\mycustomsref{#1}{\myref@lang@subsubsectiontitle}{#2}}
\WithSuffix\newcommand\mysubsubsectionref*[2][]{\mycustomsref*{#1}{\myref@lang@subsubsectiontitle}{#2}}
% For reference on appendix.
\newcommand\myappendixref[2][]{\mycustomsref{#1}{\appendixname}{#2}}
\WithSuffix\newcommand\myappendixref*[2][]{\mycustomsref*{#1}{\appendixname}{#2}}
% For reference on figure.
\newcommand\myfigureref[2][]{\mycustomsref{#1}{\figurename}{#2}}
\WithSuffix\newcommand\myfigureref*[2][]{\mycustomsref*{#1}{\figurename}{#2}}
% For reference on table.
\newcommand\mytableref[2][]{\mycustomsref{#1}{\tablename}{#2}}
\WithSuffix\newcommand\mytableref*[2][]{\mycustomsref*{#1}{\tablename}{#2}}

% End of package
\endinput
