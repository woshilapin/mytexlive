\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{myref}[2011/04/29]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Declare package options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language options
\newif\if@myenglish \@myenglishfalse
\DeclareOption{myenglish}{\@myenglishtrue}
\newif\if@myfrancais \@myfrancaisfalse
\DeclareOption{myfrancais}{\@myfrancaistrue}
% To have smart reference with 'varioref' package
\newif\if@smartref \@smartreffalse
\DeclareOption{smartref}{\@smartreftrue}
% In case of unknown options
\DeclareOption*{%
	\PackageWarning{myref}{Unknown option `\CurrentOption'}%
}

\ProcessOptions

%% Options to pass to packages
\if@smartref
	\if@myenglish
		\PassOptionsToPackage{english}{varioref}
	\fi
	\if@myfrancais
		\PassOptionsToPackage{french}{varioref}
	\fi
\fi

%% Packages to call
\RequirePackage{xifthen}
\RequirePackage{xkeyval}
% The 'suffix' package offers the '\WithSuffix' command to define starred commands
\RequirePackage{suffix}
\if@smartref
	% The 'varioref' produces smart reference with page precision if needed
	\RequirePackage{varioref}
\fi

%%%%%%%%%%%%%%%%%%%%%%%
%% New configuration %%
%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%
%% New commands %%
%%%%%%%%%%%%%%%%%%
% Define some language commands
\if@myenglish
	\newcommand{\myref@lang@see}{see}
	\newcommand{\myref@lang@sectiontitle}{Section}
	\newcommand{\myref@lang@subsectiontitle}{Section}
	\newcommand{\myref@lang@subsubsectiontitle}{Section}
	\newcommand{\myref@lang@equationname}{Equation}
\fi
\if@myfrancais
	\newcommand{\myref@lang@see}{voir}
	\newcommand{\myref@lang@sectiontitle}{Section}
	\newcommand{\myref@lang@subsectiontitle}{Section}
	\newcommand{\myref@lang@subsubsectiontitle}{Section}
	\newcommand{\myref@lang@equationname}{Ã‰quation}
\fi
%% To define the reference name
% The word(s) to put before the number of the reference (like 'section' or 'figure' for example).
\define@key[my]{ref}{refname}[none]{\def\myref@name{#1}}
\setkeys[my]{ref}{refname={}}
% Boolean value to make a reference on the form '(see Chapter 1)' instead of 'Chapter 1'.
\define@boolkey[my]{ref}{refsee}[false]{}
\setkeys[my]{ref}{refsee={false}}
% Define the 'see'-word for see-reference (see 'refsee') -> difficult to understand ugh ?
% For example, if 'refseename' is 'foo', a see-reference will produce '(foo Chapter 1)' instead of '(see Chapter 1)'.
\define@key[my]{ref}{refseename}[\myref@lang@see]{\def\myref@seename{#1}}
\setkeys[my]{ref}{refseename=\myref@lang@see}
% Use '\setkeys[my]{ref}{refdefaultfont={<whatever>}}' to change the default font for reference.
\define@key[my]{ref}{refdefaultfont}[]{\def\myref@default@font{#1}}
\setkeys[my]{ref}{refdefaultfont={}}
% Define the font for the 'refname' word(s).
% 'refdefaultfont' MUST be initialized before.
\define@key[my]{ref}{reffont}[\myref@default@font]{\def\myref@font{#1}}
\setkeys[my]{ref}{reffont={\myref@default@font}}
%% Define the standard reference
\newcommand{\myref}[2][]{%
	\setkeys[my]{ref}{#1}%
	\ifmy@ref@refsee%
		\if@smartref%
			(\myref@seename\ {\myref@font\myref@name}~\vref{#2})%
		\else%
			(\myref@seename\ {\myref@font\myref@name}~\ref{#2})%
		\fi%
	\else%
		\if@smartref%
			{\myref@font\myref@name}~\vref{#2}%
		\else%
			{\myref@font\myref@name}~\ref{#2}%
		\fi%
	\fi%
	% Reinitialized all key values
	\setkeys[my]{ref}{refname={},refsee={false},refseename=\myref@lang@see,reffont={\myref@default@font}}%
	}
% The starred version of '\myref' activate the 'refsee'.
\WithSuffix\newcommand\myref*[2][]{\myref[#1]{#2}}
% Intermediate command to test the presence of optional arguments
\newcommand{\mycustomsref}[3]{%
	\ifx#1\@empty%
		\myref[refname=#2]{#3}%
	\else%
		\myref[refname=#2,#1]{#3}%
	\fi%
}
% The starred version of '\mycustomsref' to activate the 'refsee' flag.
\WithSuffix\newcommand\mycustomsref*[3]{\mycustomsref{refsee=true,#1}{#2}{#3}}
% Command to create all necessary commands about a particular type of reference
% For example,
% \mycreatecustomsref{section}{Section}{Super-section}
% will create commands '\mysectionref, '\mysectionref*, '\mySectionref' and '\mySectionref*'
% All of these new commands will prefix the reference with 'Super-section'.
\def\mycreatecustomsref#1#2#3{
	\expandafter\newcommand\csname my#1ref\endcsname[2][]{\mycustomsref{##1}{\MakeLowercase{#3}}{##2}}
	\WithSuffix\expandafter\newcommand\csname my#1ref\endcsname*[2][]{\mycustomsref*{##1}{\MakeLowercase{#3}}{##2}}
	\expandafter\newcommand\csname my#2ref\endcsname[2][]{\mycustomsref{##1}{\expandafter\makefirstuc\expandafter{#3}}{##2}}
	\WithSuffix\expandafter\newcommand\csname my#2ref\endcsname*[2][]{\mycustomsref*{##1}{\expandafter\makefirstuc\expandafter{#3}}{##2}}
}
%% About specialized command for references.
%% The starred versions are activating the 'refsee' flag.
% For reference on part.
\mycreatecustomsref{part}{Part}{\partname}
% For reference on chapter.
\mycreatecustomsref{chapter}{Chapter}{\chaptername}
% For reference on section.
\mycreatecustomsref{section}{Section}{\myref@lang@sectiontitle}
% For reference on subsection.
\mycreatecustomsref{subsection}{Subsection}{\myref@lang@subsectiontitle}
% For reference on subsubsection.
\mycreatecustomsref{subsubsection}{Subsubsection}{\myref@lang@subsubsectiontitle}
% For reference on appendix.
\mycreatecustomsref{appendix}{Appendix}{\appendixname}
% For reference on figure.
\mycreatecustomsref{figure}{Figure}{\figurename}
% For reference on table.
\mycreatecustomsref{table}{Table}{\tablename}
% For reference on equation
\mycreatecustomsref{equation}{Equation}{\myref@lang@equationname}

% End of package
\endinput
